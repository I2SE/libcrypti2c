#include <check.h>
#include <assert.h>
#include <errno.h>
#include <fcntl.h>
#include "../libcryptoauth.h"
#include <libxml/parser.h>

static uint8_t ecc108[] = {
    0x01, 0x23, 0x53, 0x64, 0x80, 0x00, 0x10, 0x01,
    0x51, 0x2A, 0xCB, 0x1C, 0xEE, 0xC0, 0xA7, 0x00,

    0xC0, 0x00, 0xAA, 0x00, 0x81, 0xA0, 0x81, 0xA0,
    0x81, 0xA0, 0x81, 0xA0, 0x81, 0xA0, 0x81, 0xA0,
    0x81, 0xA0, 0x81, 0xA0, 0x00, 0x00, 0x81, 0xA0,
    0x81, 0xA0, 0x81, 0xA0, 0x81, 0xA0, 0x81, 0xA0,
    0x81, 0xA0, 0x81, 0xA0, 0xFF, 0x00, 0xFF, 0x00,
    0xFF, 0x00, 0xFF, 0x00, 0xFF, 0x00, 0xFF, 0x00,
    0xFF, 0x00, 0xFF, 0x00, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    0xFF, 0xFF, 0xFF, 0xFF, 0x00, 0x09, 0x00, 0x00,
    0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x33, 0x00, 0x33, 0x00, 0x33, 0x00, 0x33, 0x00,
    0x33, 0x00, 0x33, 0x00, 0x33, 0x00, 0x3C, 0x00,
    0x33, 0x00, 0x33, 0x00, 0x33, 0x00, 0x33, 0x00,
    0x33, 0x00, 0x33, 0x00, 0x33, 0x00, 0x33, 0x00
};


START_TEST(test_xml_parse)
{

    struct lca_octet_buffer result;

    assert (0 == lca_config2bin("../data/atecc108_default.xml", &result));

    ck_assert (NULL != result.ptr);

    printf ("C: %p, l %u\n", result.ptr, result.len);

    lca_set_log_level(LCA_DEBUG);
    lca_print_hex_string ("Config zone", result.ptr, result.len);
    lca_set_log_level(LCA_INFO);

    assert (0 == memcmp(ecc108, result.ptr, result.len) );
}
END_TEST

START_TEST(test_build_otp)
{
    struct lca_octet_buffer otp;

    otp = lca_build_otp_zone ();

    ck_assert (NULL != otp.ptr);
    ck_assert (otp.len == 64);

    printf("%s\n", otp.ptr);

}
END_TEST

Suite * xml_suite(void)
{
    Suite *s;
    TCase *tc_core;

    s = suite_create("XML");

    /* Core test case */
    tc_core = tcase_create("XML");


    tcase_add_test(tc_core, test_xml_parse);
    tcase_add_test(tc_core, test_build_otp);
    suite_add_tcase(s, tc_core);


    return s;
}
